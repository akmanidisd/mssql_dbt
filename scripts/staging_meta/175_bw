-- for _BW ADD NEW COLUMN REPLACING _BW with _ID
-- EXCLUDING TABLES THAT CONTAIN SF_COLUMN_NAME IN ('USER_CONTACT_PREF_BW','USER_ACCOUNT_BW')
-- THIS COLUMNS WILL BE ADDED FROM PK.SQL FOR KEYS WITH 2 COLUMNS

INSERT INTO MS_RAW.STG_META.SF_COLUMNS
      (SF_TABLE_SCHEMA, SF_TABLE_NAME, SF_COLUMN_NAME, 
       NEW_COLUMN_NAME, DATA_TYPE)
SELECT SF_TABLE_SCHEMA, SF_TABLE_NAME, SF_COLUMN_NAME, 
       REPLACE(SF_COLUMN_NAME,'_BW','_ID') AS NEW_COLUMN_NAME, 
       DATA_TYPE
FROM MS_RAW.STG_META.SF_COLUMNS C
WHERE SF_COLUMN_NAME ILIKE '%_BW'
  AND SF_TABLE_NAME NOT IN (SELECT DISTINCT SF_TABLE_NAME 
                              FROM MS_RAW.STG_META.SF_COLUMNS
                             WHERE SF_COLUMN_NAME IN ('USER_CONTACT_PREF_BW','USER_ACCOUNT_BW')
                           ) -- WILL BE ADDED IN PK.SQL
  AND NOT EXISTS (SELECT 1 FROM MS_RAW.STG_META.SF_COLUMNS S
                  WHERE S.SF_TABLE_SCHEMA = C.SF_TABLE_SCHEMA
                    AND S.SF_TABLE_NAME   = C.SF_TABLE_NAME
                    AND S.SF_COLUMN_NAME  = C.SF_COLUMN_NAME
                    AND S.NEW_COLUMN_NAME ILIKE '%_ID')
ORDER BY ALL
;

SELECT * FROM MS_RAW.STG_META.SF_COLUMNS
 WHERE SF_COLUMN_NAME ILIKE '%_BW'
ORDER BY ALL;

